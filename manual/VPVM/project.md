---
layout: page
title: "プロジェクト"
description: ""
group: manual
---
{% include JB/setup %}

プロジェクトはモデル、モーション、アクセサリをひとつにまとめて管理する情報のことです。MMDAI2 は基本的にプロジェクト単位で行い、保存するときはプロジェクトにまとめます。プロジェクトファイルは MMD のような pmm 形式ではなく xml 形式で保存されます。

プロジェクトファイルは xml 形式であるため、zip や 7z などで圧縮すると大幅にファイルサイズを小さくすることができます。また、定期的にバックアップをとってください。

1. プロジェクトを新しく作る方法
----------------------------

メニューから「ファイル」の「新規プロジェクト作成」で新しくプロジェクトを作成することができます。変更点がある場合「変更しますか」のダイアログが出ます。最初に立ち上げた状態は常に新規にプロジェクトが作成されている状態になります。

プロジェクトの新規作成を行うとそれまでの全てのモデルやモーションやアクセサリが全て破棄されるため、プロジェクトを破棄する場合はプロジェクトの新規作成を行ってください。この処理は巻き戻すことが出来ません。

2. プロジェクトの読み込み方法
--------------------------

方法は以下の３つあります。

 * 1. メニューから「ファイル」の「プロジェクト読み込み」からプロジェクトのファイルを指定する
 * 2. アプリケーションのウィンドウにプロジェクトのファイルに直接ドラッグ・アンド・ドロップする
 * 3. アプリケーションのアイコンにプロジェクトのファイルを直接ドラッグ・アンド・ドロップする

いずれも変更点がある場合「変更しますか」のダイアログが出ます。また、読み込めない場合は警告ダイアログが表示されます。読み込めない場合は以下を確認してください。もし MMDAI2 で保存したのに読み込めない場合は開発者に連絡してください。

* xml 形式のファイルであり、かつ MMDAI2 で保存した xml ファイルであるかどうか?
* 重複した UUID がないかどうか?

プロジェクトを読み込むと「新規プロジェクト作成」と同じように前回のプロジェクトは破棄され、読み込まれたプロジェクトに上書きされます。この処理は巻き戻すことが出来ません。

3. プロジェクトの保存方法
----------------------

メニューから「ファイル」の「プロジェクトを保存」または「プロジェクトを別名で保存」で保存できます。前者は前回のファイル名で、後者はダイアログが開いて新しいファイル名を指定して保存します。もし「プロジェクトの保存」で前回のファイル名がない場合は「プロジェクトを別名で保存」と同じです。

4. プロジェクトの設定
------------------

プロジェクトの設定はメニューから「プロジェクト」で行うことが出来ます。これらの情報はプロジェクトファイルに保存されます。

### 4.1 再生設定

再生の設定を行います。メニューの「プロジェクト」の「再生」または「再生設定」にある「再生」ボタンで再生設定に従って場面を再生します。「音声のファイル名」が指定されている場合は音声を再生し、出力します。

#### 4.1.1 音声のファイル名

再生時に再生される音声ファイルを指定します。「開く(Open)」ボタンでファイルダイアログが表示され、ファイルを指定すると左側のテキストボックスにダイアログで指定したパス名が表示されます。このパス名は直接編集することができます。

音声ファイルは以下の条件を「全て」満たす必要があります。ひとつでも満たさないと再生しても音声が流れません。

 * 1\. 音声ファイルが存在すること
 * 2\. 音声ファイルのフォーマットが WAV 形式 (拡張子は .wav) であること
 * 3\. 音声ファイルのコーデックが PCM 16bit Little Endian であること
 * 4\. 音声ファイルの周波数が 44KHz (44100Hz) であること
 
普通音声ファイルは MP3 や AAC などでエンコードされるため、MMDAI2 で使う際は上記の条件に合致するようにデコードを行う必要があります。MP3 や AAC のような不可逆形式の場合は仕様上エンコード前の元の音質と同じ (厳密に言うと近くなるだけ) にすることは出来ません。

#### 4.1.2 フレーム開始位置

再生時のフレームの開始位置を指定します。途中から再生したい場合はこの値を変更してください。デフォルトでは 0 が指定されます。

#### 4.1.3 フレーム終了位置

再生時のフレームの終了位置を指定します。通常はモーションの終了位置を指定しますが、途中で終了したい場合はこの値を変更してください。デフォルトではモーションの終了位置が指定されます。

#### 4.1.4 場面の FPS

再生時の FPS (Frame Per Second) の「限度」を指定します。モデルやアクセサリによっては描画負荷の影響で「場面の FPS」で指定した値を下回ることがあります。場面の FPS は 30FPS / 60FPS / 120FPS の3つから選択します。デフォルトでは 60 FPS が指定されます。

#### 4.1.5 繰り返し再生

「フレームの終了位置」に到達したら「フレームの開始位置」に戻って再び再生するかを指定します。「繰り返し再生」を有効にした場合進捗ダイアログの「キャンセル」で終了する必要があります。デフォルトでは無効です。

#### 4.1.6 選択状態にする

モデルを選択状態のままにし、タイムラインと同期するかを指定します。「選択状態にする」を有効にした場合負荷が高くなるため、FPS が落ちます。デフォルトでは無効です。

#### 4.1.7 ボーンの接続状態を表示する

モデルのボーンの接続状態を表示したまま再生するかを指定します。ボーンの動きを確認する場合は有効にしてください。負荷は小さいため、基本的に「選択状態にする」程 FPS が下がることはありません。デフォルトでは無効です。

### 4.2 重力設定

物理シミュレーションで用いられる重力の設定を行います。値を負にすると重力と同じ方向を、正にすると逆に常に浮いているようなフワフワする表現をすることができます。負の値を大きくしすぎるとモデルがつぶれてしまいますのでご注意ください。デフォルトでは (X=0.0, Y=-9.8, Z=0.0) です。

#### 4.2.1 シード値

Bullet Physics に渡すシード値を渡します。デフォルトは 0 です。0.25.0 から導入されました。

### 4.3 描画順設定 (Render order setting)

モデルまたはアクセサリの描画順を設定します。描画順は上にいくほど先に、下にいくほど後に描画されます。ボタンで上下を変更できる他、モデル名またはアクセサリ名をドラッグ・アンド・ドロップによって変更することが出来ます。

### 4.4 アクセラレーションの設定

PMD/PMX で行う頂点スキニングに対する処理方法の設定を行います。うまくいけば高速化が期待できますが、場合によっては正しくレンダリングできなくなるかもしれません。

#### 4.4.1 ソフトウェアスキニング

デフォルトのスキニング方法であり、CPU のみで頂点スキニングを行います。最も遅いですが、確実にレンダリング出来ます。

#### 4.4.2 OpenCL スキニング (GPU)

OpenCL を用いて頂点スキニングを行います。場合によっては最も高速に処理出来ますが、場合によっては正しくレンダリングされないことがあります。GPU か CPU かどちらが選択されるかはマシンに依存します。また、(GPU) とありますが、実際には GPU がない場合「OpenCL スキニング (CPU)」と同じ処理が行われます。

バイナリ配布されるものでは MacOSX でのみ利用可能です。Linux の場合はソースビルドで明示的に指定した場合のみ利用可能です。

#### 4.4.3 OpenCL スキニング (CPU)

強制的に CPU が使用されることを除けば「OpenCL スキニング (GPU)」と同じようにOpenCL を用いて頂点スキニングを行います。GPU を使う場合に比べると遅いですが、ソフトウェアスキニングより高速に処理出来ます。

バイナリ配布されるものでは MacOSX でのみ利用可能です。Linux の場合はソースビルドで明示的に指定した場合のみ利用可能です。0.25.0 から導入されました。

#### 4.4.4 頂点シェーダスキニング

頂点シェーダを用いて頂点スキニングを行います。OpenCL と異なりソフトウェアスキニングと同じように選択可能であり、「OpenCL スキニング (GPU)」とほぼ同等な速度を得られますが、あまり正しくレンダリング出来ないかもしれません。

### 4.5 物理シミュレーションの有効化

Bullet Physics を使って物理シミュレーションを有効にします。物理シミュレーションは再生またはエンコード時のみ有効になり、編集中は常に無効の状態になります。デフォルトでは有効です。

### 4.6 グリッドの表示

位置調整の参考として地面に 5.0 単位で 20x20 の格子状のグリッドが描画されます。デフォルトでは有効です。

### 4.7 背景色設定

背景色を任意の色に設定するためのダイアログを開きます。例えばクロマキー表示をしたい時に便利です。ダイアログの表示方法は OS に依存します。

### 4.8 シャドウマップ設定

シャドウマップの設定を行うためのダイアログを開きます。

#### 4.8.1 大きさ

シャドウマップで使用するテクスチャの大きさを設定します。小さくすると描画負荷が下がりますが、影のジャギー(影が荒くなる)が目立つようになります。大きくすると影のジャギーを減らせますが、描画負荷が上がります。

デフォルトは 1024x1024 です。設定可能な最大の大きさはマシンに依存します。(内部的には GL_MAX_TEXTURE_SIZE の値を取得しています)

#### 4.8.2 ソフトシャドウを有効にする

ソフトシャドウは影のぼかし処理を入れて影のジャギーを減らす処理です。かなり大きな負荷の処理のため、重い場合は無効にしてください。デフォルトは有効です。

#### 4.8.3 光源を自動的に計算する

光源を自動的に計算するかあるいは任意の中心点と半径を元に計算するかを設定します。光源は基本的にモデルの大きさと中心点と光源方向に基づいてバウンディングスフィアを作成し、バウンディングスフィア内にある場面をシャドウマップを生成します。モデルによっては正しく算出出来無いことがあるため、これを任意の値に変更することが可能です。

中心点はバウンディングスフィアの中心点を設定し、半径はバウンディングスフィアの半径を設定します。半径は大きければ大きいほどカバー出来る範囲が広がりますが、影が荒くなります。デフォルトは有効です。

### 4.9 背景画像の読み込み

場面の背景に表示する画像を設定します。BMP/JPG/GIF/PNG の画像が読み込み可能です。MacOSX の場合はさらに動画 (AVI/M4V/MP4/MOV) を読み込むことが可能です。ファイルを指定して読み込むと画面の中央に画像が表示されます。動画の場合はフレームの位置の更新に従って動画も相当する位置にシークされます。

### 4.10 背景画像の消去

場面の背景画像を消去します。消去時の背景画像の設定はリセットされずに残ります。

### 4.11 背景画像の設定

背景画像の位置と背景画像の表示方法を設定するためのダイアログが開きます。背景画像の位置は場面中央の位置からの相対位置となります。「背景画像を場面の大きさに合わせる」を有効にすると場面の大きさに応じて自動的に背景画像の大きさが調整されます。そのため、背景画像の大きさが場面より小さいと引き伸ばし表示になり、逆に場面より大きいと縮小表示になります。


